<html>
	
	<head>
		<script language="javascript" type="text/javascript" src="/static/flot/jquery.js"></script>
		<script language="javascript" type="text/javascript" src="/static/flot/jquery.flot.js"></script>
		<link href="style.css" rel="stylesheet" type="text/css">
	</head>
	
	<body>
		<div id="title">HAPPYMETER</div>

		<br>
		<br>

		<div id="happyface">:|</div>

		<br>
		<br>

		<div id="plot"></div>
		<div id="tweets"></div>

		<script type="text/javascript">
			$(function() {
				var data = [];
				var updateInterval = 1000;
				var width = 100;
				var tweetslength = 0;

				var blah = 0;

				var first = true;

				var options = {
					series: { shadowSize: 0 }, // drawing is faster without shadows
			        yaxis: { min: 0, max: 35000 },
			        xaxis: { show: false }
				}

				//var plot = $.plot($("#plot"), [ 50 ], options);
				$.plot("#plot", data, options);

				while (data.length < width)
					data.push(50);

				function plotData() {
					if (data.length > 0)
						data = data.slice(1);

					var url = "getData";

					$.getJSON(url, function(json) {
						stocks = json[0];
						total = 0;
						for (var i = 0; i < stocks.length; i++) {
							total += parseInt(stocks[i]);
						}

						while (data.length < width) {
							data.push(total);
						}

						var res = [];
						for (var i = 0; i < data.length; ++i)
            				res.push([i, data[i]]);

            			if (first == true) {
            				first = false;
            				options["yaxis"]["max"] = total * 1.5;
            			}

						$.plot("#plot", [res], options);

						//tweets
						tweetslength++;
						if(tweetslength > 50) {
							$('#tweets').text("");
							tweetslength = 0;
						}
						//'<div class="arrow-up"></div>'
						//'<div class="arrow-down"></div>'
						if (tweets == "positive") {

						}
						else if (tweets == "negative") {

						}
						else {

						}
						$('#tweets').prepend(json[1][0] + "<br><br>");

					});

				}
				
				function update() {
					plotData();

					setTimeout(update, updateInterval);
				}

				update();

			});

		</script>
	</body>
	
</html>